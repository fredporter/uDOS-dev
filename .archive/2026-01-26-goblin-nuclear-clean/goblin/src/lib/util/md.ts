// @ts-nocheck
import { Processor } from "@robino/md";
import langCss from "@shikijs/langs/css";
import langDiff from "@shikijs/langs/diff";
import langHtml from "@shikijs/langs/html";
import langJson from "@shikijs/langs/json";
import langMd from "@shikijs/langs/md";
import langSql from "@shikijs/langs/sql";
import langTsx from "@shikijs/langs/tsx";
import type { MarkedExtension } from "marked";
import emojiRegex from "emoji-regex";

// GitHub-flavored markdown emoji support
// Converts :emoji: shortcodes to Unicode emoji characters
const emojiExtension: MarkedExtension = {
  extensions: [
    {
      name: "emoji",
      level: "inline",
      start(src) {
        return src.match(/:/)?.index;
      },
      tokenizer(src) {
        const match = src.match(/^:([a-z0-9_+-]+):/i);
        if (match) {
          const shortcode = match[1];
          const emoji = getEmojiFromShortcode(shortcode);
          if (emoji) {
            return {
              type: "emoji",
              raw: match[0],
              emoji,
            };
          }
        }
        return undefined;
      },
      renderer(token: any) {
        return `<span class="emoji">${token.emoji}</span>`;
      },
    },
  ],
};

// Common emoji shortcode mappings (GitHub-flavored markdown)
const emojiMap: Record<string, string> = {
  // Smileys & Emotion
  smile: "ğŸ˜„",
  grin: "ğŸ˜",
  joy: "ğŸ˜‚",
  heart: "â¤ï¸",
  heart_eyes: "ğŸ˜",
  kissing_heart: "ğŸ˜˜",
  relaxed: "ğŸ˜Š",
  blush: "ğŸ˜Š",
  wink: "ğŸ˜‰",
  yum: "ğŸ˜‹",
  stuck_out_tongue: "ğŸ˜›",
  sleeping: "ğŸ˜´",
  worried: "ğŸ˜Ÿ",
  frowning: "â˜¹ï¸",
  anguished: "ğŸ˜§",
  open_mouth: "ğŸ˜®",
  grimacing: "ğŸ˜¬",
  confused: "ğŸ˜•",
  hushed: "ğŸ˜¯",
  expressionless: "ğŸ˜‘",
  unamused: "ğŸ˜’",
  sweat_smile: "ğŸ˜…",
  sweat: "ğŸ˜“",
  disappointed_relieved: "ğŸ˜¥",
  weary: "ğŸ˜©",
  pensive: "ğŸ˜”",
  disappointed: "ğŸ˜",
  confounded: "ğŸ˜–",
  fearful: "ğŸ˜¨",
  cold_sweat: "ğŸ˜°",
  persevere: "ğŸ˜£",
  cry: "ğŸ˜¢",
  sob: "ğŸ˜­",
  scream: "ğŸ˜±",
  angry: "ğŸ˜ ",
  rage: "ğŸ˜¡",
  triumph: "ğŸ˜¤",
  sleepy: "ğŸ˜ª",
  dizzy_face: "ğŸ˜µ",
  mask: "ğŸ˜·",
  sunglasses: "ğŸ˜",
  thinking: "ğŸ¤”",

  // Gestures & Body Parts
  "+1": "ğŸ‘",
  thumbsup: "ğŸ‘",
  "-1": "ğŸ‘",
  thumbsdown: "ğŸ‘",
  ok_hand: "ğŸ‘Œ",
  punch: "ğŸ‘Š",
  fist: "âœŠ",
  wave: "ğŸ‘‹",
  hand: "âœ‹",
  raised_hand: "âœ‹",
  clap: "ğŸ‘",
  pray: "ğŸ™",
  muscle: "ğŸ’ª",

  // Animals & Nature
  dog: "ğŸ¶",
  cat: "ğŸ±",
  mouse: "ğŸ­",
  hamster: "ğŸ¹",
  rabbit: "ğŸ°",
  fox: "ğŸ¦Š",
  bear: "ğŸ»",
  panda: "ğŸ¼",
  koala: "ğŸ¨",
  tiger: "ğŸ¯",
  lion: "ğŸ¦",
  cow: "ğŸ®",
  pig: "ğŸ·",
  frog: "ğŸ¸",
  monkey: "ğŸµ",
  chicken: "ğŸ”",
  penguin: "ğŸ§",
  bird: "ğŸ¦",
  baby_chick: "ğŸ¤",
  bug: "ğŸ›",
  bee: "ğŸ",
  ant: "ğŸœ",
  snail: "ğŸŒ",
  octopus: "ğŸ™",
  shell: "ğŸš",
  fish: "ğŸŸ",
  dolphin: "ğŸ¬",
  whale: "ğŸ³",
  dragon: "ğŸ‰",
  cactus: "ğŸŒµ",
  christmas_tree: "ğŸ„",
  evergreen_tree: "ğŸŒ²",
  deciduous_tree: "ğŸŒ³",
  palm_tree: "ğŸŒ´",
  seedling: "ğŸŒ±",
  herb: "ğŸŒ¿",
  shamrock: "â˜˜ï¸",
  four_leaf_clover: "ğŸ€",
  bamboo: "ğŸ‹",
  tanabata_tree: "ğŸ‹",
  leaves: "ğŸƒ",
  fallen_leaf: "ğŸ‚",
  maple_leaf: "ğŸ",
  mushroom: "ğŸ„",
  ear_of_rice: "ğŸŒ¾",
  bouquet: "ğŸ’",
  tulip: "ğŸŒ·",
  rose: "ğŸŒ¹",
  sunflower: "ğŸŒ»",
  blossom: "ğŸŒ¼",
  cherry_blossom: "ğŸŒ¸",
  hibiscus: "ğŸŒº",
  earth_americas: "ğŸŒ",
  earth_africa: "ğŸŒ",
  earth_asia: "ğŸŒ",
  full_moon: "ğŸŒ•",
  waning_gibbous_moon: "ğŸŒ–",
  last_quarter_moon: "ğŸŒ—",
  waning_crescent_moon: "ğŸŒ˜",
  new_moon: "ğŸŒ‘",
  waxing_crescent_moon: "ğŸŒ’",
  first_quarter_moon: "ğŸŒ“",
  waxing_gibbous_moon: "ğŸŒ”",
  new_moon_with_face: "ğŸŒš",
  full_moon_with_face: "ğŸŒ",
  first_quarter_moon_with_face: "ğŸŒ›",
  last_quarter_moon_with_face: "ğŸŒœ",
  sun_with_face: "ğŸŒ",
  crescent_moon: "ğŸŒ™",
  star: "â­",
  star2: "ğŸŒŸ",
  dizzy: "ğŸ’«",
  sparkles: "âœ¨",
  comet: "â˜„ï¸",
  sunny: "â˜€ï¸",
  sun: "â˜€ï¸",
  partly_sunny: "â›…",
  cloud: "â˜ï¸",
  zap: "âš¡",
  fire: "ğŸ”¥",
  boom: "ğŸ’¥",
  snowflake: "â„ï¸",
  snowman: "â›„",
  rainbow: "ğŸŒˆ",
  ocean: "ğŸŒŠ",

  // Food & Drink
  coffee: "â˜•",
  tea: "ğŸµ",
  sake: "ğŸ¶",
  beer: "ğŸº",
  beers: "ğŸ»",
  wine_glass: "ğŸ·",
  cocktail: "ğŸ¸",
  tropical_drink: "ğŸ¹",
  champagne: "ğŸ¾",
  apple: "ğŸ",
  green_apple: "ğŸ",
  tangerine: "ğŸŠ",
  lemon: "ğŸ‹",
  cherries: "ğŸ’",
  grapes: "ğŸ‡",
  watermelon: "ğŸ‰",
  strawberry: "ğŸ“",
  melon: "ğŸˆ",
  banana: "ğŸŒ",
  pineapple: "ğŸ",
  peach: "ğŸ‘",
  pear: "ğŸ",
  tomato: "ğŸ…",
  eggplant: "ğŸ†",
  hot_pepper: "ğŸŒ¶ï¸",
  corn: "ğŸŒ½",
  sweet_potato: "ğŸ ",
  carrot: "ğŸ¥•",
  bread: "ğŸ",
  croissant: "ğŸ¥",
  pancakes: "ğŸ¥",
  cheese: "ğŸ§€",
  meat_on_bone: "ğŸ–",
  poultry_leg: "ğŸ—",
  bacon: "ğŸ¥“",
  hamburger: "ğŸ”",
  fries: "ğŸŸ",
  pizza: "ğŸ•",
  hotdog: "ğŸŒ­",
  taco: "ğŸŒ®",
  burrito: "ğŸŒ¯",
  egg: "ğŸ¥š",
  fried_egg: "ğŸ³",
  ramen: "ğŸœ",
  stew: "ğŸ²",
  fish_cake: "ğŸ¥",
  sushi: "ğŸ£",
  bento: "ğŸ±",
  curry: "ğŸ›",
  rice_ball: "ğŸ™",
  rice: "ğŸš",
  rice_cracker: "ğŸ˜",
  oden: "ğŸ¢",
  dango: "ğŸ¡",
  shaved_ice: "ğŸ§",
  ice_cream: "ğŸ¨",
  icecream: "ğŸ¦",
  cake: "ğŸ°",
  birthday: "ğŸ‚",
  custard: "ğŸ®",
  candy: "ğŸ¬",
  lollipop: "ğŸ­",
  chocolate_bar: "ğŸ«",
  popcorn: "ğŸ¿",
  doughnut: "ğŸ©",
  cookie: "ğŸª",

  // Travel & Places
  car: "ğŸš—",
  taxi: "ğŸš•",
  blue_car: "ğŸš™",
  bus: "ğŸšŒ",
  trolleybus: "ğŸš",
  train: "ğŸš†",
  metro: "ğŸš‡",
  station: "ğŸš‰",
  tram: "ğŸšŠ",
  monorail: "ğŸš",
  mountain_railway: "ğŸš",
  railway_car: "ğŸšƒ",
  bullettrain_side: "ğŸš„",
  bullettrain_front: "ğŸš…",
  light_rail: "ğŸšˆ",
  steam_locomotive: "ğŸš‚",
  bike: "ğŸš²",
  motor_scooter: "ğŸ›µ",
  motorcycle: "ğŸï¸",
  rotating_light: "ğŸš¨",
  police_car: "ğŸš“",
  oncoming_police_car: "ğŸš”",
  fire_engine: "ğŸš’",
  ambulance: "ğŸš‘",
  minibus: "ğŸš",
  truck: "ğŸšš",
  articulated_lorry: "ğŸš›",
  tractor: "ğŸšœ",
  kick_scooter: "ğŸ›´",
  airplane: "âœˆï¸",
  small_airplane: "ğŸ›©ï¸",
  flight_departure: "ğŸ›«",
  flight_arrival: "ğŸ›¬",
  rocket: "ğŸš€",
  helicopter: "ğŸš",
  ship: "ğŸš¢",
  speedboat: "ğŸš¤",
  sailboat: "â›µ",
  boat: "â›µ",
  rowboat: "ğŸš£",
  anchor: "âš“",
  fuelpump: "â›½",
  construction: "ğŸš§",
  vertical_traffic_light: "ğŸš¦",
  traffic_light: "ğŸš¥",
  checkered_flag: "ğŸ",
  tent: "â›º",
  rainbow_flag: "ğŸ³ï¸â€ğŸŒˆ",
  pirate_flag: "ğŸ´â€â˜ ï¸",
  flag_us: "ğŸ‡ºğŸ‡¸",
  flag_gb: "ğŸ‡¬ğŸ‡§",
  flag_fr: "ğŸ‡«ğŸ‡·",
  flag_de: "ğŸ‡©ğŸ‡ª",
  flag_jp: "ğŸ‡¯ğŸ‡µ",
  flag_kr: "ğŸ‡°ğŸ‡·",
  flag_cn: "ğŸ‡¨ğŸ‡³",
  flag_ru: "ğŸ‡·ğŸ‡º",

  // Activities
  soccer: "âš½",
  baseball: "âš¾",
  basketball: "ğŸ€",
  volleyball: "ğŸ",
  football: "ğŸˆ",
  rugby_football: "ğŸ‰",
  tennis: "ğŸ¾",
  "8ball": "ğŸ±",
  bowling: "ğŸ³",
  golf: "â›³",
  mountain_bicyclist: "ğŸšµ",
  bicyclist: "ğŸš´",
  horse_racing: "ğŸ‡",
  snowboarder: "ğŸ‚",
  swimmer: "ğŸŠ",
  surfer: "ğŸ„",
  ski: "ğŸ¿",
  fishing_pole_and_fish: "ğŸ£",
  running_shirt_with_sash: "ğŸ½",
  trophy: "ğŸ†",
  medal_sports: "ğŸ…",
  medal_military: "ğŸ–ï¸",
  "1st_place_medal": "ğŸ¥‡",
  "2nd_place_medal": "ğŸ¥ˆ",
  "3rd_place_medal": "ğŸ¥‰",
  dart: "ğŸ¯",
  video_game: "ğŸ®",
  space_invader: "ğŸ‘¾",
  game_die: "ğŸ²",
  slot_machine: "ğŸ°",

  // Objects
  watch: "âŒš",
  iphone: "ğŸ“±",
  calling: "ğŸ“²",
  computer: "ğŸ’»",
  keyboard: "âŒ¨ï¸",
  desktop_computer: "ğŸ–¥ï¸",
  printer: "ğŸ–¨ï¸",
  computer_mouse: "ğŸ–±ï¸",
  trackball: "ğŸ–²ï¸",
  joystick: "ğŸ•¹ï¸",
  clamp: "ğŸ—œï¸",
  minidisc: "ğŸ’½",
  floppy_disk: "ğŸ’¾",
  cd: "ğŸ’¿",
  dvd: "ğŸ“€",
  vhs: "ğŸ“¼",
  camera: "ğŸ“·",
  camera_flash: "ğŸ“¸",
  video_camera: "ğŸ“¹",
  movie_camera: "ğŸ¥",
  film_projector: "ğŸ“½ï¸",
  film_strip: "ğŸï¸",
  telephone_receiver: "ğŸ“",
  phone: "â˜ï¸",
  pager: "ğŸ“Ÿ",
  fax: "ğŸ“ ",
  tv: "ğŸ“º",
  radio: "ğŸ“»",
  microphone: "ğŸ¤",
  studio_microphone: "ğŸ™ï¸",
  level_slider: "ğŸšï¸",
  control_knobs: "ğŸ›ï¸",
  stopwatch: "â±ï¸",
  timer_clock: "â²ï¸",
  alarm_clock: "â°",
  hourglass_flowing_sand: "â³",
  hourglass: "âŒ›",
  satellite: "ğŸ“¡",
  battery: "ğŸ”‹",
  electric_plug: "ğŸ”Œ",
  bulb: "ğŸ’¡",
  flashlight: "ğŸ”¦",
  candle: "ğŸ•¯ï¸",
  fire_extinguisher: "ğŸ§¯",
  wrench: "ğŸ”§",
  hammer: "ğŸ”¨",
  hammer_and_pick: "âš’ï¸",
  hammer_and_wrench: "ğŸ› ï¸",
  pick: "â›ï¸",
  nut_and_bolt: "ğŸ”©",
  gear: "âš™ï¸",
  chains: "â›“ï¸",
  gun: "ğŸ”«",
  bomb: "ğŸ’£",
  hocho: "ğŸ”ª",
  dagger: "ğŸ—¡ï¸",
  crossed_swords: "âš”ï¸",
  shield: "ğŸ›¡ï¸",
  mag: "ğŸ”",
  mag_right: "ğŸ”",
  lock: "ğŸ”’",
  unlock: "ğŸ”“",
  lock_with_ink_pen: "ğŸ”",
  closed_lock_with_key: "ğŸ”",
  key: "ğŸ”‘",
  old_key: "ğŸ—ï¸",

  // Symbols
  "100": "ğŸ’¯",
  "1234": "ğŸ”¢",
  hash: "#ï¸âƒ£",
  asterisk: "*ï¸âƒ£",
  zero: "0ï¸âƒ£",
  one: "1ï¸âƒ£",
  two: "2ï¸âƒ£",
  three: "3ï¸âƒ£",
  four: "4ï¸âƒ£",
  five: "5ï¸âƒ£",
  six: "6ï¸âƒ£",
  seven: "7ï¸âƒ£",
  eight: "8ï¸âƒ£",
  nine: "9ï¸âƒ£",
  keycap_ten: "ğŸ”Ÿ",
  white_check_mark: "âœ…",
  heavy_check_mark: "âœ”ï¸",
  ballot_box_with_check: "â˜‘ï¸",
  x: "âŒ",
  negative_squared_cross_mark: "â",
  heavy_plus_sign: "â•",
  heavy_minus_sign: "â–",
  heavy_division_sign: "â—",
  heavy_multiplication_x: "âœ–ï¸",
  infinity: "â™¾ï¸",
  question: "â“",
  grey_question: "â”",
  grey_exclamation: "â•",
  exclamation: "â—",
  wavy_dash: "ã€°ï¸",
  copyright: "Â©ï¸",
  registered: "Â®ï¸",
  tm: "â„¢ï¸",
  currency_exchange: "ğŸ’±",
  dollar: "ğŸ’µ",
  yen: "ğŸ’´",
  euro: "ğŸ’¶",
  pound: "ğŸ’·",
  moneybag: "ğŸ’°",
  money_with_wings: "ğŸ’¸",
  credit_card: "ğŸ’³",
  chart: "ğŸ’¹",
  email: "ğŸ“§",
  "e-mail": "ğŸ“§",
  incoming_envelope: "ğŸ“¨",
  envelope_with_arrow: "ğŸ“©",
  outbox_tray: "ğŸ“¤",
  inbox_tray: "ğŸ“¥",
  package: "ğŸ“¦",
  mailbox: "ğŸ“«",
  mailbox_closed: "ğŸ“ª",
  mailbox_with_mail: "ğŸ“¬",
  mailbox_with_no_mail: "ğŸ“­",
  postbox: "ğŸ“®",
  ballot_box: "ğŸ—³ï¸",
  pencil2: "âœï¸",
  pencil: "ğŸ“",
  memo: "ğŸ“",
  briefcase: "ğŸ’¼",
  file_folder: "ğŸ“",
  open_file_folder: "ğŸ“‚",
  card_index_dividers: "ğŸ—‚ï¸",
  date: "ğŸ“…",
  calendar: "ğŸ“†",
  spiral_notepad: "ğŸ—’ï¸",
  spiral_calendar: "ğŸ—“ï¸",
  card_index: "ğŸ“‡",
  chart_with_upwards_trend: "ğŸ“ˆ",
  chart_with_downwards_trend: "ğŸ“‰",
  bar_chart: "ğŸ“Š",
  clipboard: "ğŸ“‹",
  pushpin: "ğŸ“Œ",
  round_pushpin: "ğŸ“",
  paperclip: "ğŸ“",
  paperclips: "ğŸ–‡ï¸",
  straight_ruler: "ğŸ“",
  triangular_ruler: "ğŸ“",
  scissors: "âœ‚ï¸",
  card_file_box: "ğŸ—ƒï¸",
  file_cabinet: "ğŸ—„ï¸",
  wastebasket: "ğŸ—‘ï¸",
  link: "ğŸ”—",
  bookmark: "ğŸ”–",
  bookmark_tabs: "ğŸ“‘",
  ledger: "ğŸ“’",
  notebook: "ğŸ““",
  notebook_with_decorative_cover: "ğŸ“”",
  closed_book: "ğŸ“•",
  green_book: "ğŸ“—",
  blue_book: "ğŸ“˜",
  orange_book: "ğŸ“™",
  books: "ğŸ“š",
  book: "ğŸ“–",
  microscope: "ğŸ”¬",
  telescope: "ğŸ”­",
  newspaper: "ğŸ“°",
  art: "ğŸ¨",
  paintbrush: "ğŸ–Œï¸",
  crayon: "ğŸ–ï¸",
  fountain_pen: "ğŸ–Šï¸",
  pen: "ğŸ–Šï¸",
  black_nib: "âœ’ï¸",

  // Flags & Symbols
  triangular_flag_on_post: "ğŸš©",
  crossed_flags: "ğŸŒ",
  black_flag: "ğŸ´",
  white_flag: "ğŸ³ï¸",

  // Arrows
  arrow_left: "â†",
  arrow_right: "â†’",
  arrow_up: "â†‘",
  arrow_down: "â†“",
  arrow_upper_left: "â†–ï¸",
  arrow_upper_right: "â†—ï¸",
  arrow_lower_right: "â†˜ï¸",
  arrow_lower_left: "â†™ï¸",
  left_right_arrow: "â†”ï¸",
  arrow_up_down: "â†•ï¸",
  arrows_counterclockwise: "ğŸ”„",
  arrow_backward: "â—€ï¸",
  arrow_forward: "â–¶ï¸",
  arrow_up_small: "ğŸ”¼",
  arrow_down_small: "ğŸ”½",
  leftwards_arrow_with_hook: "â†©ï¸",
  arrow_right_hook: "â†ªï¸",
  information_source: "â„¹ï¸",
  rewind: "âª",
  fast_forward: "â©",
  arrow_double_up: "â«",
  arrow_double_down: "â¬",
  arrow_heading_up: "â¤´ï¸",
  arrow_heading_down: "â¤µï¸",
};

function getEmojiFromShortcode(shortcode: string): string | null {
  return emojiMap[shortcode.toLowerCase()] || null;
}

export const processor = new Processor({
  anchor: false,
  highlighter: {
    langs: [langCss, langHtml, langTsx, langDiff, langJson, langSql, langMd],
    langAlias: {
      js: "tsx",
      ts: "tsx",
      jsx: "tsx",
      mdx: "md",
      svelte: "html",
      astro: "html",
    },
  },
  marked: {
    extensions: [emojiExtension],
  },
});
