{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://udos.local/schemas/overlay.schema.json",
  "title": "uDOS Knowledge Overlay",
  "description": "Schema for user knowledge overlays",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100,
      "description": "Overlay name"
    },
    "description": {
      "type": "string",
      "maxLength": 500,
      "description": "Overlay description"
    },
    "author": {
      "type": "string",
      "description": "Creator's user ID"
    },
    "created": {
      "type": "string",
      "format": "date-time"
    },
    "updated": {
      "type": "string",
      "format": "date-time"
    },
    "include": {
      "type": "object",
      "properties": {
        "documents": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Specific document IDs to include"
        },
        "categories": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z0-9-]+(/[a-z0-9-]+)*(\\*)?$"
          },
          "description": "Categories to include (supports wildcards)"
        },
        "tags": {
          "type": "object",
          "properties": {
            "any": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Include if any tag matches"
            },
            "all": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Include only if all tags match"
            }
          }
        },
        "locations": {
          "type": "object",
          "properties": {
            "tiles": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Tile coordinates (supports wildcards)"
            },
            "regions": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Region names"
            }
          }
        },
        "quality": {
          "type": "object",
          "properties": {
            "min_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 5
            },
            "verified_only": {
              "type": "boolean",
              "default": false
            }
          }
        }
      }
    },
    "exclude": {
      "type": "object",
      "properties": {
        "global_knowledge": {
          "type": "boolean",
          "default": false,
          "description": "Exclude all global knowledge"
        },
        "documents": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Specific document IDs to exclude"
        },
        "tags": {
          "type": "object",
          "properties": {
            "any": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Exclude if any tag matches"
            }
          }
        },
        "skill_level": {
          "type": "object",
          "properties": {
            "below": {
              "type": "string",
              "enum": ["beginner", "intermediate", "advanced", "expert"],
              "description": "Hide content below this level"
            },
            "above": {
              "type": "string",
              "enum": ["beginner", "intermediate", "advanced", "expert"],
              "description": "Hide content above this level"
            }
          }
        }
      }
    },
    "structure": {
      "type": "object",
      "properties": {
        "sections": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "filter": { "type": "object" }
            },
            "required": ["name"]
          },
          "description": "Custom sections within overlay"
        }
      }
    },
    "sort": {
      "type": "object",
      "properties": {
        "primary": {
          "type": "string",
          "enum": ["quality.score", "updated", "created", "title", "usage_count"],
          "default": "quality.score"
        },
        "direction": {
          "type": "string",
          "enum": ["asc", "desc"],
          "default": "desc"
        },
        "secondary": {
          "type": "string",
          "enum": ["quality.score", "updated", "created", "title", "usage_count"]
        }
      }
    }
  },
  "required": ["name"]
}
