# Secrets Management for uDOS

**Status:** üîê All API keys moved to `.env` (gitignored)  
**Last Updated:** 2026-01-18

---

## Overview

All API keys, tokens, and credentials are now stored in **`.env`** file which is **never committed to git**.

### Before (INSECURE ‚ùå)

```
wizard/config/ai_keys.json        ‚Üê Contains LIVE OpenAI/Gemini keys in git
public/wizard/config/ai_keys.json ‚Üê Exposed to public repo
```

### After (SECURE ‚úÖ)

```
.env                              ‚Üê Local only, gitignored (has your secrets)
.env.template                     ‚Üê Shared template (no secrets, committed to git)
wizard/config/ai_keys.json        ‚Üê Generated from .env (gitignored)
```

---

## Quick Start

### 1. Create .env file (First Time)

```bash
cp .env.template .env
nano .env  # or vim .env
```

### 2. Add your API keys to .env

```bash
GEMINI_API_KEY=your-actual-key-here
OPENAI_API_KEY=sk-proj-xxx
ANTHROPIC_API_KEY=sk-ant-xxx
MISTRAL_API_KEY=xxx
GITHUB_TOKEN=ghp_xxx
# ... etc
```

### 3. Generate config files from .env

```bash
./bin/setup-secrets.sh
```

Done! ‚úÖ Config files generated automatically.

---

## What Goes Where

### .env (LOCAL ONLY - Never commit)

```
OPENAI_API_KEY=sk-proj-...
GEMINI_API_KEY=AIzaSy...
MISTRAL_API_KEY=xxx
GITHUB_TOKEN=ghp_...
# ... all credentials here
```

### .env.template (COMMITTED to git)

```
# Template only - no actual values
OPENAI_API_KEY=
GEMINI_API_KEY=
MISTRAL_API_KEY=
GITHUB_TOKEN=
```

### wizard/config/ai_keys.json (GENERATED, not committed)

```json
{
  "GEMINI_API_KEY": "AIzaSy...",
  "OPENAI_API_KEY": "sk-proj-...",
  "MISTRAL_API_KEY": "xxx"
}
```

Generated by `setup-secrets.sh` from your `.env` file.

---

## Environment Variables

### AI Providers

```bash
GEMINI_API_KEY          # Google Gemini
OPENAI_API_KEY          # OpenAI GPT models
ANTHROPIC_API_KEY       # Claude (Anthropic)
MISTRAL_API_KEY         # Mistral AI
OPENROUTER_API_KEY      # OpenRouter (cloud routing)
```

### GitHub Integration

```bash
GITHUB_TOKEN            # Personal access token (repo, workflow scopes)
GITHUB_WEBHOOK_SECRET   # Webhook signing secret
```

### OAuth Providers

```bash
GOOGLE_CLIENT_ID        # Google OAuth
GOOGLE_CLIENT_SECRET
GITHUB_OAUTH_ID         # GitHub OAuth
GITHUB_OAUTH_SECRET
MICROSOFT_CLIENT_ID     # Microsoft OAuth
MICROSOFT_CLIENT_SECRET
APPLE_CLIENT_ID         # Apple OAuth
APPLE_CLIENT_SECRET
```

### Integration Services

```bash
SLACK_BOT_TOKEN         # Slack bot token
SLACK_SIGNING_SECRET    # Slack webhook secret
SLACK_APP_TOKEN

NOTION_INTEGRATION_TOKEN  # Notion API token

HUBSPOT_API_KEY         # HubSpot CRM

GMAIL_CLIENT_ID         # Gmail OAuth
GMAIL_CLIENT_SECRET
GMAIL_REFRESH_TOKEN

NOUNPROJECT_API_KEY     # Noun Project API
NOUNPROJECT_API_SECRET

ICLOUD_USERNAME         # iCloud backup relay
ICLOUD_PASSWORD
ICLOUD_2FA_SECRET
```

### Development Configuration

```bash
WIZARD_PORT=8765        # Wizard server port
GOBLIN_PORT=8767        # Goblin dev server port
API_PORT=3000           # API server port

NODE_ENV=development
PYTHON_ENV=development
LOG_LEVEL=info
```

---

## Getting API Keys

### Google Gemini

1. Go to: https://aistudio.google.com/apikey
2. Click "Get API key"
3. Create new API key in existing project
4. Copy to `GEMINI_API_KEY=...` in `.env`

### OpenAI

1. Go to: https://platform.openai.com/account/api-keys
2. Create new secret key
3. Copy to `OPENAI_API_KEY=...` in `.env`
4. **‚ö†Ô∏è Never share this key!**

### Anthropic (Claude)

1. Go to: https://console.anthropic.com/account/keys
2. Create new API key
3. Copy to `ANTHROPIC_API_KEY=...` in `.env`

### GitHub Token

1. Go to: https://github.com/settings/tokens
2. Click "Generate new token (classic)"
3. Select scopes:
   - `repo` (full control of repositories)
   - `workflow` (update GitHub Actions workflows)
   - `admin:repo_hook` (webhooks)
4. Copy to `GITHUB_TOKEN=...` in `.env`

### OAuth Providers (Google, GitHub, Microsoft)

- Create apps in respective developer consoles
- Get Client ID and Client Secret
- Add to `.env` as `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`, etc.

---

## Python Code Example

```python
from dotenv import load_dotenv
import os
import json

# Load .env into environment
load_dotenv()

# Method 1: Direct from environment
api_key = os.getenv("OPENAI_API_KEY")

# Method 2: Read generated config file
with open("wizard/config/ai_keys.json") as f:
    config = json.load(f)
    openai_key = config["OPENAI_API_KEY"]

# Use in your code
client = OpenAI(api_key=api_key)
```

---

## Node.js Code Example

```javascript
require("dotenv").config();

// Method 1: Direct from environment
const apiKey = process.env.OPENAI_API_KEY;

// Method 2: Read generated config file
const config = require("./wizard/config/ai_keys.json");
const apiKey = config.OPENAI_API_KEY;

// Use in your code
const openai = new OpenAI({ apiKey });
```

---

## Security Checklist

- ‚úÖ `.env` is in `.gitignore` (won't be committed)
- ‚úÖ `.env.template` is committed (template only, no secrets)
- ‚úÖ Generated config files are gitignored
- ‚úÖ Never share `.env` file or commit it
- ‚úÖ Use environment-specific `.env.local` files for sensitive overrides
- ‚úÖ Rotate API keys periodically
- ‚úÖ Monitor API key usage in provider dashboards
- ‚úÖ Use GitHub Actions secrets for CI/CD pipelines

---

## CI/CD Integration (GitHub Actions)

For automated workflows, set secrets in GitHub:

**Go to:** Repository Settings ‚Üí Secrets and variables ‚Üí Actions

**Add secrets:**

```
OPENAI_API_KEY = (your key)
GEMINI_API_KEY = (your key)
GITHUB_TOKEN = (your PAT)
```

**Access in workflows:**

```yaml
- name: Deploy
  env:
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
  run: ./deploy.sh
```

---

## Troubleshooting

### "OPENAI_API_KEY not found"

```bash
# Check .env exists
ls -la .env

# Check it has the key
grep OPENAI_API_KEY .env

# Regenerate configs
./bin/setup-secrets.sh

# In Python, ensure you loaded dotenv:
from dotenv import load_dotenv
load_dotenv()  # Must call this first!
```

### "Config file not found"

```bash
# Run setup script
./bin/setup-secrets.sh

# Check files were created
ls -la wizard/config/ai_keys.json
ls -la public/wizard/config/ai_keys.json
```

### "Keys are empty in config"

```bash
# Make sure .env has actual values (not blanks)
nano .env

# Regenerate
./bin/setup-secrets.sh
```

---

## Secure Key Rotation

When rotating keys:

1. **Create new key** in provider (Google/OpenAI/etc)
2. **Update .env** with new key
3. **Run:** `./bin/setup-secrets.sh` to regenerate configs
4. **Test** with new key in development
5. **Deactivate old key** in provider console
6. **Monitor** for any errors from old key usage

---

## Team Collaboration

### For Individual Developers

- Each developer has their own `.env` (never shared)
- Share `.env.template` in repo (template only)
- Each dev fills in their own keys

### For Team with Shared Secrets

Use **1Password** or **AWS Secrets Manager**:

```bash
# Example: Load from 1Password
op run --env-file="op://vault/secret-name" -- python app.py
```

### For CI/CD

Use **GitHub Secrets** (Settings ‚Üí Secrets):

```yaml
env:
  OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
```

---

## Migration from Old System

If you had secrets in git before:

1. **Revoke all exposed keys** in provider dashboards!
2. **Create new keys**
3. **Update .env** with new keys
4. **Run:** `./bin/setup-secrets.sh`
5. **Commit:** `.gitignore` and `.env.template` changes
6. **Remove from history** (optional, use `git filter-branch` or BFG)

---

_For more info, see: `.env.template`, `.gitignore`, `bin/setup-secrets.sh`_
